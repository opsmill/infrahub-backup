---
title: CLI command reference
---

Complete reference for all Infrahub Operations Tools commands, flags, and options. The tools are split into two specialized binaries: `infrahub-backup` for backup/restore operations and `infrahub-taskmanager` for task manager maintenance.

## infrahub-backup

### Command structure

```bash
infrahub-backup [global-flags] <command> [flags] [arguments]
```

### Global flags

These flags apply to all infrahub-backup commands:

| Flag | Description | Default | Environment Variable |
|------|-------------|---------|---------------------|
| `--project <name>` | Target specific Docker Compose project | Auto-detect | `INFRAHUB_PROJECT` |
| `--backup-dir <path>` | Directory for backup files | `./infrahub_backups` | `INFRAHUB_BACKUP_DIR` |
| `--log-format <text\|json>` | Output format for logs | `text` | `INFRAHUB_LOG_FORMAT` |
| `--help, -h` | Show help for any command | - | - |

### Backup commands

#### create

Creates a comprehensive backup of the Infrahub instance.

**Syntax:**

```bash
infrahub-backup create [flags]
```

**Flags:**

| Flag | Description | Default |
|------|-------------|---------|
| `--force` | Force backup even if tasks are running | `false` |
| `--neo4jmetadata <type>` | Neo4j metadata to include | `all` |

**Neo4j metadata options:**

- `all` - Include all user and role metadata
- `users` - Include only user accounts
- `roles` - Include only role definitions
- `none` - Exclude all metadata

**Examples:**

```bash
# Basic backup
infrahub-backup create

# Force backup with running tasks
infrahub-backup create --force

# Backup without user metadata
infrahub-backup create --neo4jmetadata=none
```

#### restore

Restores Infrahub from a backup file.

**Syntax:**

```bash
infrahub-backup restore <backup-file>
```

**Arguments:**

- `<backup-file>` - Path to backup archive (required)

**Examples:**

```bash
# Basic restore
infrahub-backup restore infrahub_backup_20250929_143022.tar.gz
```

### Environment commands

#### environment detect

Detects and displays the current deployment environment.

**Syntax:**

```bash
infrahub-backup environment detect
```

**Example output:**

```shell
INFO[0000] Detecting deployment environment...
INFO[0000] Docker environment detected
INFO[0000] Found Docker Compose project: infrahub-demo
```

#### environment list

Lists all available Infrahub Docker Compose projects.

**Syntax:**

```bash
infrahub-backup environment list
```

**Example output:**

```bash
infrahub-production  Running   7/7
infrahub-staging     Running   7/7
infrahub-dev         Stopped   0/7
```

### Utility commands

#### version

Displays version information.

**Syntax:**

```bash
infrahub-backup version
```

**Example output:**

```bash
Version: 1.0.0
```

## infrahub-taskmanager

### Command structure

```bash
infrahub-taskmanager [global-flags] <command> <subcommand> [flags] [arguments]
```

### Global flags

These flags apply to all infrahub-taskmanager commands:

| Flag | Description | Default | Environment Variable |
|------|-------------|---------|---------------------|
| `--project <name>` | Target specific Docker Compose project | Auto-detect | `INFRAHUB_PROJECT` |
| `--log-format <text\|json>` | Output format for logs | `text` | `INFRAHUB_LOG_FORMAT` |
| `--help, -h` | Show help for any command | - | - |

### Task manager commands

#### flush

Cleans up old task records.

**Syntax:**

```bash
infrahub-taskmanager flush <type> [days] [batch-size]
```

**Subcommands:**

- `flow-runs [days] [batch-size]` - Delete completed/failed/cancelled flow runs older than retention period
- `stale-runs [days] [batch-size]` - Cancel flow runs still RUNNING and older than retention period

**Arguments:**

- `[days]` - Age threshold in days (optional)
- `[batch-size]` - Records per batch (optional)

**Defaults:**

- `flow-runs`: 30 days, batch size 200
- `stale-runs`: 2 days, batch size 200

**Examples:**

```bash
# Clean flows older than 30 days
infrahub-taskmanager flush flow-runs

# Clean flows older than 7 days
infrahub-taskmanager flush flow-runs 7

# Cancel stale runs older than 1 day
infrahub-taskmanager flush stale-runs 1

# Custom batch size
infrahub-taskmanager flush flow-runs 30 500
```

### Environment commands

#### environment detect

Detects and displays the current deployment environment.

**Syntax:**

```bash
infrahub-taskmanager environment detect
```

#### environment list

Lists all available Infrahub Docker Compose projects.

**Syntax:**

```bash
infrahub-taskmanager environment list
```

### Utility commands

#### version

Displays version information.

**Syntax:**

```bash
infrahub-taskmanager version
```

**Example output:**

```bash
Version: 1.0.0
```

## Common environment variables

Environment variables that affect the Infrahub Operations Tools:

| Variable | Description | Default | Used By |
|----------|-------------|---------|---------|
| `INFRAHUB_BACKUP_DIR` | Default backup directory | `./infrahub_backups` | infrahub-backup |
| `INFRAHUB_PROJECT` | Docker Compose project name | Auto-detect | Both tools |
| `INFRAHUB_DB_DATABASE` | Neo4j database name | `neo4j` | infrahub-backup |
| `INFRAHUB_DB_USERNAME` | Neo4j username | `neo4j` | infrahub-backup |
| `INFRAHUB_DB_PASSWORD` | Neo4j password | `admin` | infrahub-backup |
| `PREFECT_API_DATABASE_CONNECTION_URL` | PostgreSQL connection string | Auto-detect | Both tools |
| `INFRAHUB_LOG_FORMAT` | Log format (text/json) | `text` | Both tools |

## Configuration precedence

Configuration values are resolved in this order:

1. Command-line flags (highest priority)
2. Environment variables
3. Default values (lowest priority)

## Related documentation

- [Getting started tutorial](../tutorials/getting-started.mdx)
- [Configuration reference](./configuration.mdx)
- [How to backup your instance](../guides/backup-instance.mdx)
