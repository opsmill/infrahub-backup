---
title: CLI command reference
---

Complete reference for all infrahubops commands, flags, and options currently implemented in Phase 1.

## Command structure

```bash
infrahubops [global-flags] <command> <subcommand> [flags] [arguments]
```

## Global flags

These flags apply to all commands:

| Flag | Description | Default | Environment Variable |
|------|-------------|---------|---------------------|
| `--project <name>` | Target specific Docker Compose project | Auto-detect | `INFRAHUB_PROJECT` |
| `--backup-dir <path>` | Directory for backup files | `./infrahub_backups` | `INFRAHUB_BACKUP_DIR` |
| `--log-format <text\|json>` | Output format for logs | `text` | `INFRAHUB_LOG_FORMAT` |
| `--help, -h` | Show help for any command | - | - |

## Backup commands

### backup create

Creates a comprehensive backup of the Infrahub instance.

**Syntax:**

```bash
infrahubops backup create [flags]
```

**Flags:**

| Flag | Description | Default |
|------|-------------|---------|
| `--force` | Force backup even if tasks are running | `false` |
| `--neo4jmetadata <type>` | Neo4j metadata to include | `all` |

**Neo4j metadata options:**

- `all` - Include all user and role metadata
- `users` - Include only user accounts
- `roles` - Include only role definitions
- `none` - Exclude all metadata

**Examples:**

```bash
# Basic backup
infrahubops backup create

# Force backup with running tasks
infrahubops backup create --force

# Backup without user metadata
infrahubops backup create --neo4jmetadata=none
```

### backup restore

Restores Infrahub from a backup file.

**Syntax:**

```bash
infrahubops backup restore <backup-file>
```

**Arguments:**

- `<backup-file>` - Path to backup archive (required)

**Examples:**

```bash
# Basic restore
infrahubops backup restore infrahub_backup_20250929_143022.tar.gz
```

## Environment commands

### environment detect

Detects and displays the current deployment environment.

**Syntax:**

```bash
infrahubops environment detect
```

**Example output:**

```
INFO[0000] Detecting deployment environment...
INFO[0000] Docker environment detected
INFO[0000] Found Docker Compose project: infrahub-demo
```

### environment list

Lists all available Infrahub Docker Compose projects.

**Syntax:**

```bash
infrahubops environment list
```

**Example output:**

```bash
infrahub-production  Running   7/7
infrahub-staging     Running   7/7
infrahub-dev         Stopped   0/7
```

## Task manager commands

### taskmanager flush

Cleans up old task records.

**Syntax:**

```bash
infrahubops taskmanager flush <type> [days] [batch-size]
```

**Arguments:**

- `<type>` - Type of flush operation (required)
  - `flow-runs` - Remove old completed/failed runs
  - `stale-runs` - Cancel stuck running tasks
- `[days]` - Age threshold in days (optional)
- `[batch-size]` - Records per batch (optional)

**Defaults:**

- `flow-runs`: 30 days, batch size 200
- `stale-runs`: 2 days, batch size 200

**Examples:**

```bash
# Clean flows older than 30 days
infrahubops taskmanager flush flow-runs

# Clean flows older than 7 days
infrahubops taskmanager flush flow-runs 7

# Cancel stale runs older than 1 day
infrahubops taskmanager flush stale-runs 1

# Custom batch size
infrahubops taskmanager flush flow-runs 30 500
```

## Utility commands

### version

Displays version information.

**Syntax:**

```bash
infrahubops version
```

**Example output:**

```bash
infrahubops version 1.0.0
```

### help

Shows help for any command.

**Syntax:**

```bash
infrahubops help [command]
```

**Examples:**

```bash
# General help
infrahubops help

# Command-specific help
infrahubops help backup
infrahubops help backup create
```

## Environment variables

All environment variables that affect infrahubops behavior:

| Variable | Description | Default |
|----------|-------------|---------|
| `INFRAHUB_BACKUP_DIR` | Default backup directory | `./infrahub_backups` |
| `INFRAHUB_PROJECT` | Docker Compose project name | Auto-detect |
| `INFRAHUB_DB_DATABASE` | Neo4j database name | `neo4j` |
| `INFRAHUB_DB_USERNAME` | Neo4j username | `neo4j` |
| `INFRAHUB_DB_PASSWORD` | Neo4j password | `admin` |
| `PREFECT_API_DATABASE_CONNECTION_URL` | PostgreSQL connection string | Auto-detect |
| `INFRAHUB_LOG_FORMAT` | Log format (text/json) | `text` |

## Configuration precedence

Configuration values are resolved in this order:

1. Command-line flags (highest priority)
2. Environment variables
3. Default values (lowest priority)

## Related documentation

- [Getting started tutorial](../tutorials/getting-started.mdx)
- [Configuration reference](./configuration.mdx)
- [How to backup your instance](../guides/backup-instance.mdx)
